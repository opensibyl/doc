# 标记系统（施工中，0.15.0上线）

opensibyl 的目标之一是通用性，而业务形态千差万别，如何在支撑极其复杂的业务需求的同时，让系统保持整洁高效。标记系统是我们给出的答案。

## why？

:::info
机制脱胎于业务。
:::

我们在制作sibyl2的前身时，因为无止境的业务需求扩张导致平台膨胀得过于臃肿。后来经历一次革新，将sibyl2单独抽离成独立服务，只提供基础数据，业务需求统一由二方服务承接。

![](https://user-images.githubusercontent.com/13421694/220233468-6155f8b4-6c86-43c6-a179-12340f50230f.png)

这样做我们是爽了，但二方平台开发者抱怨颇多。

举个例子，有个二方平台是从spring工程中抽取API、service方法并统一管理的。如果用SDK来编写：

- 平台方几乎需要对每个版本都做全量的方法提取，并在本地解析
- 而其中绝大多数的IO是不需要的，对业务方与平台都是云成本浪费
- 也带来了许多无意义的序列化，很慢，体验不好

如果二方平台在扫描时配好规则，预先找到他们需要的数据，打上标记，再在需要的时候直接根据标记取用？

![](https://user-images.githubusercontent.com/13421694/220233732-0e5d56ff-c191-4a66-8ca5-6b0e555843d4.png)

这就是 TAG 系统的来源。二方平台的开发至此分为两个部分：

- 扫描器：利用 sibyl2 的能力，在静态扫描时期直接抽取需要的数据，在系统中进行打标
- 平台：直接根据标记取用对应的数据，不再需要额外盲查

而在此基础上，平台也做到了较好的分工：

- sibyl平台只需要支撑好标记能力，而不需要理解标记本身的含义
- 二方平台可以结合自己需要设计标记，利用标记与sibyl交互

## 一些场景参考：

- 上面提到的spring inspector
- 结合 commitmsg 判断方法与哪个需求有关
- 结合覆盖率标记方法的覆盖情况
- ...
