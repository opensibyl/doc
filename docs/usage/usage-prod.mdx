---
sidebar_position: 3
---

# 使用 - 服务化

服务器模式是我们重点维护的模式。我们希望它能够被无缝集成到你的流水线内，而不需要做过多修改。

## 下载

同命令行模式。

## 单节点模式

在大部分情况下（除了公司级中台），单节点情况可以满足你的绝大多数需求。

内置的队列与badger数据库，使你也可以轻松在办公电脑上部署并保持良好的性能。

默认情况下你的数据会被持久化在 `./.sibyl2storage` 中。

### 启动服务端

```
./sibyl server
```

你可以看到，你的服务已经启动了。

```
[GIN-debug] GET    /api/v1/file              --> github.com/williamfzc/sibyl2/pkg/server.HandleFileQuery (3 handlers)
[GIN-debug] GET    /api/v1/func              --> github.com/williamfzc/sibyl2/pkg/server.HandleFunctionsQuery (3 handlers)
[GIN-debug] GET    /api/v1/funcctx           --> github.com/williamfzc/sibyl2/pkg/server.HandleFunctionCtxQuery (3 handlers)
[GIN-debug] POST   /api/v1/func              --> github.com/williamfzc/sibyl2/pkg/server.HandleRepoFuncUpload (3 handlers)
[GIN-debug] POST   /api/v1/funcctx           --> github.com/williamfzc/sibyl2/pkg/server.HandleFunctionContextUpload (3 handlers)
[GIN-debug] GET    /api/v1/admin/upload/status --> github.com/williamfzc/sibyl2/pkg/server.HandleStatusUpload (3 handlers)
[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.
Please check https://pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.
[GIN-debug] Listening and serving HTTP on :9876
```

你可以直接打开 http://127.0.0.1:9876/swagger/index.html#/ 查看接口文档。

### 扫描代码仓

```
./sibyl upload --src . --withCtx
```

看到下列日志即可代表上传完成。

```
{"level":"info","ts":1670140951.991765,"caller":"upload/cmd_upload.go:171","msg":"upload batch: 200 - 220"}
{"level":"info","ts":1670140952.001775,"caller":"upload/cmd_upload.go:171","msg":"upload batch: 220 - 240"}
{"level":"info","ts":1670140952.0041962,"caller":"upload/cmd_upload.go:90","msg":"upload graph finished"}
{"level":"info","ts":1670140952.0042171,"caller":"upload/cmd_upload.go:93","msg":"upload finished"}
```

### 查看结果

![](/img/usage-swagger.png)

通常你只需要关注五个接口：

- /repo：用于查询当前一共有哪些代码仓
- /rev：用于查询指定代码仓名下的版本
- /file：查询特定仓特定版本下的文件列表
- /func：函数信息查询
- /funcctx：函数信息及上下文查询

## 多节点模式

对于一些企业级中台，有横向扩容与分布式存储管理的需求。

![](https://user-images.githubusercontent.com/13421694/207398617-ee015eea-b9bd-4b57-8479-4c690246be17.png)

https://github.com/opensibyl/sibyl2/issues/2

迭代方向如下：

- 横扩：提供标准kafka connector对接
- 存储：**我们没有想好。** 但基于badger与neo4j，考虑TiKV与各类分布式图数据库。

欢迎通过issue交流。
